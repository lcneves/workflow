# @workflow/web-e2e

Playwright end-to-end tests for the Workflow Web UI.

## Overview

These tests verify that the Workflow Web UI correctly displays workflow runs, steps, hooks, and other data. They run after the main e2e tests and can use the runIds generated by those tests.

## Test Coverage

- **Runs List**: Tests the main runs table view, filters, and pagination
- **Run Detail View**: Tests the run detail page with trace, graph, and streams tabs
- **Hooks Tab**: Tests the hooks listing functionality
- **Workflows Tab**: Tests the workflows list (local backend only)
- **Navigation**: Tests navigating between views
- **Error Handling**: Tests graceful error handling for invalid data

## Running Tests

### Prerequisites

1. Build the workspace packages:

   ```bash
   pnpm build
   ```

2. (Optional) Run the main e2e tests first to generate runIds:

   ```bash
   APP_NAME=nextjs-turbopack DEPLOYMENT_URL=http://localhost:3000 pnpm test:e2e
   ```

### Running Web E2E Tests

```bash
# Run against local backend (default)
cd packages/web-e2e
pnpm test

# Run against Vercel backend
WORKFLOW_WEB_E2E_BACKEND=vercel \
WORKFLOW_VERCEL_AUTH_TOKEN=<token> \
WORKFLOW_VERCEL_PROJECT=<project-id> \
WORKFLOW_VERCEL_TEAM=<team-slug> \
pnpm test

# Run with headed browser for debugging
pnpm test:headed

# Run with Playwright UI
pnpm test:ui
```

### Environment Variables

| Variable | Description | Default |
|----------|-------------|---------|
| `WORKFLOW_WEB_E2E_BACKEND` | Backend type: `local` or `vercel` | `local` |
| `WORKFLOW_WEB_PORT` | Port for the web UI server | `3456` |
| `APP_NAME` | Workbench app name (for local backend) | `nextjs-turbopack` |
| `WORKFLOW_VERCEL_AUTH_TOKEN` | Vercel auth token (for vercel backend) | - |
| `WORKFLOW_VERCEL_PROJECT` | Vercel project ID (for vercel backend) | - |
| `WORKFLOW_VERCEL_TEAM` | Vercel team slug (for vercel backend) | - |
| `WORKFLOW_VERCEL_ENV` | Vercel environment: `production` or `preview` | `preview` |

## Test Fixtures

The tests use custom Playwright fixtures that:

1. **WebServer**: Manages the @workflow/web Next.js server lifecycle
2. **webPage**: A page pre-navigated to the web UI with correct config params
3. **e2eMetadata**: RunIds from previous e2e tests (if available)
4. **getRunId/getAnyRunId**: Helper functions to get runIds for testing

## CI Integration

These tests run as part of the GitHub Actions workflow after the main e2e tests complete. The workflow:

1. Downloads e2e result artifacts (which include runId metadata)
2. Builds the web package
3. Runs Playwright tests against local and Vercel backends
4. Uploads test results and screenshots as artifacts

## Development

```bash
# Install dependencies
pnpm install

# Run tests with debug output
DEBUG=pw:api pnpm test

# View test report
pnpm report
```
