---
title: resumeWebhook
---

トークンで識別される webhook に HTTP `Request` を送信して、ワークフローの実行を再開します。

この関数は `hook_received` イベントを作成し、ワークフローの実行を続行するために再トリガーします。外部の HTTP リクエストを受け取る API ルートやサーバーアクションから呼び出されることを想定しています。

<Callout type="warn">
`resumeWebhook` はワークフロー関数の外部から呼び出す必要があるランタイム関数です。
</Callout>

```typescript lineNumbers
import { resumeWebhook } from "workflow/api";

export async function POST(request: Request) {
  const url = new URL(request.url);
  const token = url.searchParams.get("token");

  if (!token) {
    return new Response("Missing token", { status: 400 });
  }

  try {
    const response = await resumeWebhook(token, request); // [!code highlight]
    return response;
  } catch (error) {
    return new Response("Webhook not found", { status: 404 });
  }
}
```

## API シグネチャ

### パラメータ

<TSDoc
definition={`
import { resumeWebhook } from "workflow/api";
export default resumeWebhook;`}
showSections={['parameters']}
/>

### 戻り値

`Promise<Response>` を返し、その解決値は次の通りです:

- `Response`: ワークフローの `respondWith()` 呼び出しからの HTTP レスポンス

ウェブフックトークンが見つからないか無効な場合はエラーを投げます。

## 例

### 基本的な API ルート

着信の HTTP リクエストをトークンで指定されたウェブフックに転送します:

```typescript lineNumbers
import { resumeWebhook } from "workflow/api";

export async function POST(request: Request) {
  const url = new URL(request.url);
  const token = url.searchParams.get("token");

  if (!token) {
    return new Response("Token required", { status: 400 });
  }

  try {
    const response = await resumeWebhook(token, request); // [!code highlight]
    return response; // Returns the workflow's custom response
  } catch (error) {
    return new Response("Webhook not found", { status: 404 });
  }
}
```

### GitHub ウェブフックハンドラ

GitHub のウェブフックイベントを処理してワークフローに転送します:

```typescript lineNumbers
import { resumeWebhook } from "workflow/api";
import { verifyGitHubSignature } from "@/lib/github";

export async function POST(request: Request) {
  // Extract repository name from URL
  const url = new URL(request.url);
  const repo = url.pathname.split("/").pop();

  // Verify GitHub signature
  const signature = request.headers.get("x-hub-signature-256");
  const isValid = await verifyGitHubSignature(request, signature);

  if (!isValid) {
    return new Response("Invalid signature", { status: 401 });
  }

  // Construct deterministic token
  const token = `github_webhook:${repo}`;

  try {
    const response = await resumeWebhook(token, request); // [!code highlight]
    return response;
  } catch (error) {
    return new Response("Workflow not found", { status: 404 });
  }
}
```

### Slack スラッシュコマンドハンドラ

Slack のスラッシュコマンドを処理してワークフローのウェブフックにルーティングします:

```typescript lineNumbers
import { resumeWebhook } from "workflow/api";

export async function POST(request: Request) {
  const formData = await request.formData();
  const channelId = formData.get("channel_id") as string;
  const command = formData.get("command") as string;

  // Verify Slack request signature
  const slackSignature = request.headers.get("x-slack-signature");
  if (!slackSignature) {
    return new Response("Unauthorized", { status: 401 });
  }

  // Construct token from channel ID
  const token = `slack_command:${channelId}`;

  try {
    const response = await resumeWebhook(token, request); // [!code highlight]
    return response;
  } catch (error) {
    // If no workflow is listening, return a default response
    return new Response(
      JSON.stringify({
        response_type: "ephemeral",
        text: "No active workflow for this channel"
      }),
      {
        headers: { "Content-Type": "application/json" }
      }
    );
  }
}
```

### マルチテナント ウェブフックルーター

テナント／組織に基づいてウェブフックを異なるワークフローにルーティングします:

```typescript lineNumbers
import { resumeWebhook } from "workflow/api";

export async function POST(request: Request) {
  const url = new URL(request.url);

  // Extract tenant and webhook ID from path
  // e.g., /api/webhooks/tenant-123/webhook-abc
  const [, , , tenantId, webhookId] = url.pathname.split("/");

  if (!tenantId || !webhookId) {
    return new Response("Invalid webhook URL", { status: 400 });
  }

  // Verify API key for tenant
  const apiKey = request.headers.get("authorization");
  const isAuthorized = await verifyTenantApiKey(tenantId, apiKey);

  if (!isAuthorized) {
    return new Response("Unauthorized", { status: 401 });
  }

  // Construct namespaced token
  const token = `tenant:${tenantId}:webhook:${webhookId}`;

  try {
    const response = await resumeWebhook(token, request); // [!code highlight]
    return response;
  } catch (error) {
    return new Response("Webhook not found or expired", { status: 404 });
  }
}

async function verifyTenantApiKey(tenantId: string, apiKey: string | null) {
  // Verify API key logic
  return apiKey === process.env[`TENANT_${tenantId}_API_KEY`];
}
```

### サーバーアクション (Next.js)

Next.js のサーバーアクションで `resumeWebhook` を使用する:

```typescript lineNumbers
"use server";

import { resumeWebhook } from "workflow/api";

export async function triggerWebhook(
  token: string,
  payload: Record<string, any>
) {
  // Create a Request object from the payload
  const request = new Request("http://localhost/webhook", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify(payload),
  });

  try {
    const response = await resumeWebhook(token, request);

    // Parse and return the response
    const contentType = response.headers.get("content-type");
    if (contentType?.includes("application/json")) {
      return await response.json();
    }

    return await response.text();
  } catch (error) {
    throw new Error("Webhook not found");
  }
}
```

## 関連関数

- [`createWebhook()`](/docs/api-reference/workflow/create-webhook) - ワークフロー内にウェブフックを作成する
- [`resumeHook()`](/docs/api-reference/workflow-api/resume-hook) - 任意のペイロードでフックを再開する
- [`defineHook()`](/docs/api-reference/workflow/define-hook) - 型安全なフックのヘルパー