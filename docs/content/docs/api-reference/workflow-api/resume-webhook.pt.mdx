---
title: resumeWebhook
---

Retoma uma execução de workflow enviando um `Request` HTTP para um webhook identificado pelo seu token.

Esta função cria um evento `hook_received` e reaciona o workflow para continuar a execução. É projetada para ser chamada a partir de rotas de API ou ações de servidor que recebem requisições HTTP externas.

<Callout type="warn">
`resumeWebhook` é uma função em tempo de execução que deve ser chamada fora de uma função de workflow.
</Callout>

```typescript lineNumbers
import { resumeWebhook } from "workflow/api";

export async function POST(request: Request) {
  const url = new URL(request.url);
  const token = url.searchParams.get("token");

  if (!token) {
    return new Response("Missing token", { status: 400 });
  }

  try {
    const response = await resumeWebhook(token, request); // [!code highlight]
    return response;
  } catch (error) {
    return new Response("Webhook not found", { status: 404 });
  }
}
```

## Assinatura da API

### Parâmetros

<TSDoc
definition={`
import { resumeWebhook } from "workflow/api";
export default resumeWebhook;`}
showSections={['parameters']}
/>

### Retorno

Retorna uma `Promise<Response>` que resolve para:

- `Response`: A resposta HTTP da chamada `respondWith()` do workflow

Lança um erro se o token do webhook não for encontrado ou for inválido.

## Exemplos

### Rota de API Básica

Encaminhar requisições HTTP recebidas para um webhook usando o token:

```typescript lineNumbers
import { resumeWebhook } from "workflow/api";

export async function POST(request: Request) {
  const url = new URL(request.url);
  const token = url.searchParams.get("token");

  if (!token) {
    return new Response("Token required", { status: 400 });
  }

  try {
    const response = await resumeWebhook(token, request); // [!code highlight]
    return response; // Returns the workflow's custom response
  } catch (error) {
    return new Response("Webhook not found", { status: 404 });
  }
}
```

### Manipulador de Webhook do GitHub

Trate eventos de webhook do GitHub e os encaminhe para workflows:

```typescript lineNumbers
import { resumeWebhook } from "workflow/api";
import { verifyGitHubSignature } from "@/lib/github";

export async function POST(request: Request) {
  // Extract repository name from URL
  const url = new URL(request.url);
  const repo = url.pathname.split("/").pop();

  // Verify GitHub signature
  const signature = request.headers.get("x-hub-signature-256");
  const isValid = await verifyGitHubSignature(request, signature);

  if (!isValid) {
    return new Response("Invalid signature", { status: 401 });
  }

  // Construct deterministic token
  const token = `github_webhook:${repo}`;

  try {
    const response = await resumeWebhook(token, request); // [!code highlight]
    return response;
  } catch (error) {
    return new Response("Workflow not found", { status: 404 });
  }
}
```

### Manipulador de comandos slash do Slack

Procese comandos slash do Slack e encaminhe-os para webhooks de workflow:

```typescript lineNumbers
import { resumeWebhook } from "workflow/api";

export async function POST(request: Request) {
  const formData = await request.formData();
  const channelId = formData.get("channel_id") as string;
  const command = formData.get("command") as string;

  // Verify Slack request signature
  const slackSignature = request.headers.get("x-slack-signature");
  if (!slackSignature) {
    return new Response("Unauthorized", { status: 401 });
  }

  // Construct token from channel ID
  const token = `slack_command:${channelId}`;

  try {
    const response = await resumeWebhook(token, request); // [!code highlight]
    return response;
  } catch (error) {
    // If no workflow is listening, return a default response
    return new Response(
      JSON.stringify({
        response_type: "ephemeral",
        text: "No active workflow for this channel"
      }),
      {
        headers: { "Content-Type": "application/json" }
      }
    );
  }
}
```

### Roteador de Webhooks Multi-tenant

Roteie webhooks para diferentes workflows com base no tenant/organização:

```typescript lineNumbers
import { resumeWebhook } from "workflow/api";

export async function POST(request: Request) {
  const url = new URL(request.url);

  // Extract tenant and webhook ID from path
  // e.g., /api/webhooks/tenant-123/webhook-abc
  const [, , , tenantId, webhookId] = url.pathname.split("/");

  if (!tenantId || !webhookId) {
    return new Response("Invalid webhook URL", { status: 400 });
  }

  // Verify API key for tenant
  const apiKey = request.headers.get("authorization");
  const isAuthorized = await verifyTenantApiKey(tenantId, apiKey);

  if (!isAuthorized) {
    return new Response("Unauthorized", { status: 401 });
  }

  // Construct namespaced token
  const token = `tenant:${tenantId}:webhook:${webhookId}`;

  try {
    const response = await resumeWebhook(token, request); // [!code highlight]
    return response;
  } catch (error) {
    return new Response("Webhook not found or expired", { status: 404 });
  }
}

async function verifyTenantApiKey(tenantId: string, apiKey: string | null) {
  // Verify API key logic
  return apiKey === process.env[`TENANT_${tenantId}_API_KEY`];
}
```

### Ação de Servidor (Next.js)

Use `resumeWebhook` em uma ação de servidor do Next.js:

```typescript lineNumbers
"use server";

import { resumeWebhook } from "workflow/api";

export async function triggerWebhook(
  token: string,
  payload: Record<string, any>
) {
  // Create a Request object from the payload
  const request = new Request("http://localhost/webhook", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify(payload),
  });

  try {
    const response = await resumeWebhook(token, request);

    // Parse and return the response
    const contentType = response.headers.get("content-type");
    if (contentType?.includes("application/json")) {
      return await response.json();
    }

    return await response.text();
  } catch (error) {
    throw new Error("Webhook not found");
  }
}
```

## Funções Relacionadas

- [`createWebhook()`](/docs/api-reference/workflow/create-webhook) - Criar um webhook em um workflow
- [`resumeHook()`](/docs/api-reference/workflow-api/resume-hook) - Retomar um hook com payload arbitrário
- [`defineHook()`](/docs/api-reference/workflow/define-hook) - Auxiliar de hook com tipagem segura