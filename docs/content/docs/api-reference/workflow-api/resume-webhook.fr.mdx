---
title: resumeWebhook
---

Reprend l'exécution d'un workflow en envoyant une `Request` HTTP à un webhook identifié par son token.

Cette fonction crée un événement `hook_received` et relance le workflow pour poursuivre son exécution. Elle est conçue pour être appelée depuis des routes API ou des actions serveur qui reçoivent des requêtes HTTP externes.

<Callout type="warn">
`resumeWebhook` est une fonction d'exécution (runtime) qui doit être appelée depuis l'extérieur d'une fonction de workflow.
</Callout>

```typescript lineNumbers
import { resumeWebhook } from "workflow/api";

export async function POST(request: Request) {
  const url = new URL(request.url);
  const token = url.searchParams.get("token");

  if (!token) {
    return new Response("Missing token", { status: 400 });
  }

  try {
    const response = await resumeWebhook(token, request); // [!code highlight]
    return response;
  } catch (error) {
    return new Response("Webhook not found", { status: 404 });
  }
}
```

## Signature de l'API

### Paramètres

<TSDoc
definition={`
import { resumeWebhook } from "workflow/api";
export default resumeWebhook;`}
showSections={['parameters']}
/>

### Renvoie

Renvoie une `Promise<Response>` qui résout vers :

- `Response` : La réponse HTTP issue de l'appel `respondWith()` du workflow

Lance une erreur si le token du webhook n'est pas trouvé ou est invalide.

## Exemples

### Route API basique

Transférer les requêtes HTTP entrantes vers un webhook via son token :

```typescript lineNumbers
import { resumeWebhook } from "workflow/api";

export async function POST(request: Request) {
  const url = new URL(request.url);
  const token = url.searchParams.get("token");

  if (!token) {
    return new Response("Token required", { status: 400 });
  }

  try {
    const response = await resumeWebhook(token, request); // [!code highlight]
    return response; // Returns the workflow's custom response
  } catch (error) {
    return new Response("Webhook not found", { status: 404 });
  }
}
```

### Gestionnaire de webhook GitHub

Traite les événements webhook GitHub et les transfère aux workflows :

```typescript lineNumbers
import { resumeWebhook } from "workflow/api";
import { verifyGitHubSignature } from "@/lib/github";

export async function POST(request: Request) {
  // Extract repository name from URL
  const url = new URL(request.url);
  const repo = url.pathname.split("/").pop();

  // Verify GitHub signature
  const signature = request.headers.get("x-hub-signature-256");
  const isValid = await verifyGitHubSignature(request, signature);

  if (!isValid) {
    return new Response("Invalid signature", { status: 401 });
  }

  // Construct deterministic token
  const token = `github_webhook:${repo}`;

  try {
    const response = await resumeWebhook(token, request); // [!code highlight]
    return response;
  } catch (error) {
    return new Response("Workflow not found", { status: 404 });
  }
}
```

### Gestionnaire de commandes Slash Slack

Traite les commandes slash Slack et les achemine vers les webhooks de workflows :

```typescript lineNumbers
import { resumeWebhook } from "workflow/api";

export async function POST(request: Request) {
  const formData = await request.formData();
  const channelId = formData.get("channel_id") as string;
  const command = formData.get("command") as string;

  // Verify Slack request signature
  const slackSignature = request.headers.get("x-slack-signature");
  if (!slackSignature) {
    return new Response("Unauthorized", { status: 401 });
  }

  // Construct token from channel ID
  const token = `slack_command:${channelId}`;

  try {
    const response = await resumeWebhook(token, request); // [!code highlight]
    return response;
  } catch (error) {
    // If no workflow is listening, return a default response
    return new Response(
      JSON.stringify({
        response_type: "ephemeral",
        text: "No active workflow for this channel"
      }),
      {
        headers: { "Content-Type": "application/json" }
      }
    );
  }
}
```

### Routeur de webhook multi-tenant

Dirige les webhooks vers différents workflows en fonction du locataire/organisation :

```typescript lineNumbers
import { resumeWebhook } from "workflow/api";

export async function POST(request: Request) {
  const url = new URL(request.url);

  // Extract tenant and webhook ID from path
  // e.g., /api/webhooks/tenant-123/webhook-abc
  const [, , , tenantId, webhookId] = url.pathname.split("/");

  if (!tenantId || !webhookId) {
    return new Response("Invalid webhook URL", { status: 400 });
  }

  // Verify API key for tenant
  const apiKey = request.headers.get("authorization");
  const isAuthorized = await verifyTenantApiKey(tenantId, apiKey);

  if (!isAuthorized) {
    return new Response("Unauthorized", { status: 401 });
  }

  // Construct namespaced token
  const token = `tenant:${tenantId}:webhook:${webhookId}`;

  try {
    const response = await resumeWebhook(token, request); // [!code highlight]
    return response;
  } catch (error) {
    return new Response("Webhook not found or expired", { status: 404 });
  }
}

async function verifyTenantApiKey(tenantId: string, apiKey: string | null) {
  // Verify API key logic
  return apiKey === process.env[`TENANT_${tenantId}_API_KEY`];
}
```

### Action serveur (Next.js)

Utiliser `resumeWebhook` dans une action serveur Next.js :

```typescript lineNumbers
"use server";

import { resumeWebhook } from "workflow/api";

export async function triggerWebhook(
  token: string,
  payload: Record<string, any>
) {
  // Create a Request object from the payload
  const request = new Request("http://localhost/webhook", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
    },
    body: JSON.stringify(payload),
  });

  try {
    const response = await resumeWebhook(token, request);

    // Parse and return the response
    const contentType = response.headers.get("content-type");
    if (contentType?.includes("application/json")) {
      return await response.json();
    }

    return await response.text();
  } catch (error) {
    throw new Error("Webhook not found");
  }
}
```

## Fonctions associées

- [`createWebhook()`](/docs/api-reference/workflow/create-webhook) - Créer un webhook dans un workflow
- [`resumeHook()`](/docs/api-reference/workflow-api/resume-hook) - Reprendre un hook avec une charge utile arbitraire
- [`defineHook()`](/docs/api-reference/workflow/define-hook) - Assistant de hook typé