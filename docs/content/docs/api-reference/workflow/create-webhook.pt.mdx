---
title: createWebhook
---

Cria um webhook que pode ser usado para suspender e retomar uma execução de workflow ao receber uma requisição HTTP.

Webhooks fornecem uma maneira para sistemas externos enviarem requisições HTTP diretamente para o seu workflow. Ao contrário dos hooks, que aceitam payloads arbitrários, os webhooks funcionam com objetos HTTP `Request` padrão e podem retornar objetos HTTP `Response`.

```ts lineNumbers
import { createWebhook } from "workflow"

export async function webhookWorkflow() {
  "use workflow";
  const webhook = createWebhook();  // [!code highlight]
  console.log("Webhook URL:", webhook.url);

  const request = await webhook; // Suspends until HTTP request received
  console.log("Received request:", request.method, request.url);
}
```

## Assinatura da API

### Parâmetros

<TSDoc
definition={`
import { createWebhook } from "workflow";
export default createWebhook;`}
showSections={['parameters']}
/>

### Retorna

<TSDoc
definition={`
import { createWebhook } from "workflow";
export default createWebhook;`}
showSections={['returns']}
/>

O objeto `Webhook` retornado possui:

- `url`: A URL do endpoint HTTP que sistemas externos podem chamar
- `token`: O token único que identifica este webhook
- Implementa `AsyncIterable<RequestWithResponse>` para lidar com múltiplas requisições

O tipo `RequestWithResponse` estende a interface padrão `Request` com um método `respondWith(response: Response)` para enviar respostas personalizadas de volta ao chamador.

## Exemplos

### Uso básico

Cria um webhook que recebe requisições HTTP e registra os detalhes da requisição:

```typescript lineNumbers
import { createWebhook } from "workflow"

export async function basicWebhookWorkflow() {
  "use workflow";

  const webhook = createWebhook(); // [!code highlight]
  console.log("Send requests to:", webhook.url);

  const request = await webhook;

  console.log("Method:", request.method);
  console.log("Headers:", Object.fromEntries(request.headers));

  const body = await request.text();
  console.log("Body:", body);
}
```

### Respondendo a requisições de webhook

Use o método `respondWith()` para enviar respostas HTTP personalizadas. Observe que `respondWith()` deve ser chamado a partir de dentro de uma função step:

```typescript lineNumbers
import { createWebhook, type RequestWithResponse } from "workflow"

async function sendResponse(request: RequestWithResponse) { // [!code highlight]
  "use step"; // [!code highlight]
  await request.respondWith( // [!code highlight]
    new Response(JSON.stringify({ success: true, message: "Received!" }), { // [!code highlight]
      status: 200, // [!code highlight]
      headers: { "Content-Type": "application/json" } // [!code highlight]
    }) // [!code highlight]
  ); // [!code highlight]
} // [!code highlight]

export async function respondingWebhookWorkflow() {
  "use workflow";

  const webhook = createWebhook();
  console.log("Webhook URL:", webhook.url);

  const request = await webhook;

  // Send a custom response back to the caller
  await sendResponse(request);

  // Continue workflow processing
  const data = await request.json();
  await processData(data);
}

async function processData(data: any) {
  "use step";
  // Process the webhook data
  console.log("Processing:", data);
}
```

### Personalizando tokens

Tokens são usados para identificar um webhook específico. Você pode personalizar o token para ser mais específico a um caso de uso.

```typescript lineNumbers
import { type RequestWithResponse } from "workflow"

async function sendAck(request: RequestWithResponse) {
  "use step";
  await request.respondWith(
    new Response(JSON.stringify({ received: true }), {
      headers: { "Content-Type": "application/json" }
    })
  );
}

export async function githubWebhookWorkflow(repoName: string) {
  "use workflow";

  // Use a deterministic token based on the repository
  const webhook = createWebhook({ // [!code highlight]
    token: `github_webhook:${repoName}`, // [!code highlight]
  }); // [!code highlight]

  console.log("Configure GitHub webhook:", webhook.url);

  const request = await webhook;
  const event = await request.json();

  await sendAck(request);

  await deployCommit(event);
}

async function deployCommit(event: any) {
  "use step";
  // Deploy logic here
}
```

### Aguardando múltiplas requisições

Você também pode aguardar múltiplas requisições usando a sintaxe `for await...of`.

```typescript lineNumbers
import { createWebhook, type RequestWithResponse } from "workflow"

async function sendSlackResponse(request: RequestWithResponse, message: string) {
  "use step";
  await request.respondWith(
    new Response(
      JSON.stringify({
        response_type: "in_channel",
        text: message
      }),
      { headers: { "Content-Type": "application/json" } }
    )
  );
}

async function sendStopResponse(request: RequestWithResponse) {
  "use step";
  await request.respondWith(
    new Response("Stopping workflow...")
  );
}

export async function slackCommandWorkflow(channelId: string) {
  "use workflow";

  const webhook = createWebhook({
    token: `slack_command:${channelId}`,
  });

  for await (const request of webhook) { // [!code highlight]
    const formData = await request.formData();
    const command = formData.get("command");
    const text = formData.get("text");

    if (command === "/status") {
      // Respond immediately to Slack
      await sendSlackResponse(request, "Checking status...");

      // Process the command
      const status = await checkSystemStatus();
      await postToSlack(channelId, `Status: ${status}`);
    }

    if (text === "stop") {
      await sendStopResponse(request);
      break;
    }
  }
}

async function checkSystemStatus() {
  "use step";
  return "All systems operational";
}

async function postToSlack(channelId: string, message: string) {
  "use step";
  // Post message to Slack
}
```

## Funções relacionadas

- [`createHook()`](/docs/api-reference/workflow/create-hook) - Primitiva de hook de nível inferior para payloads arbitrários
- [`defineHook()`](/docs/api-reference/workflow/define-hook) - Auxiliar de hook com tipagem segura
- [`resumeWebhook()`](/docs/api-reference/workflow-api/resume-webhook) - Retoma um webhook a partir de uma rota de API