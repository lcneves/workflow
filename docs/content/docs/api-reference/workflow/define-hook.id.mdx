---
title: defineHook
---

Membuat helper hook yang type-safe yang memastikan tipe payload konsisten antara pembuatan hook dan saat hook dilanjutkan.

Ini adalah pembungkus ringan di sekitar [`createHook()`](/docs/api-reference/workflow/create-hook) dan [`resumeHook()`](/docs/api-reference/workflow-api/resume-hook) untuk menghindari ketidakcocokan tipe. Ini juga mendukung validasi dan transformasi payload saat runtime secara opsional menggunakan validator yang mematuhi [Standard Schema v1](https://standardschema.dev) seperti Zod atau Valibot.

<Callout>
Kami menyarankan menggunakan `defineHook()` dibandingkan `createHook()` dalam basis kode produksi untuk keamanan tipe yang lebih baik dan validasi runtime opsional.
</Callout>

```ts lineNumbers
import { defineHook } from "workflow";

const nameHook = defineHook<{
  name: string;
}>();

export async function nameWorkflow() {
  "use workflow";

  const hook = nameHook.create();  // [!code highlight]
  const result = await hook; // Fully typed as { name: string }
  console.log("Name:", result.name);
}
```

## Tanda Tangan API

### Parameter

<TSDoc
definition={`
import { defineHook } from "workflow";
export default defineHook;`}
showSections={['parameters']}
/>

### Mengembalikan

<TSDoc
definition={`
interface DefineHook<T> {
  /**

* Creates a new hook with the defined payload type.
  */
  create: (options?: HookOptions) => Hook<T>;

  /**

* Resumes a hook by sending a payload with the defined type.
   */
  resume: (token: string, payload: T) => Promise<HookEntity | null>;
}
export default DefineHook;`}
/>

## Contoh

### Definisi Hook Type-Safe Dasar

Dengan mendefinisikan hook sekali dengan tipe payload tertentu, Anda dapat menggunakannya kembali di beberapa workflow dan route API dengan keamanan tipe otomatis.

```typescript lineNumbers
import { defineHook } from "workflow";

// Define once with a specific payload type
const approvalHook = defineHook<{ // [!code highlight]
  approved: boolean; // [!code highlight]
  comment: string; // [!code highlight]
}>(); // [!code highlight]

// In your workflow
export async function workflowWithApproval() {
  "use workflow";

  const hook = approvalHook.create();
  const result = await hook; // Fully typed as { approved: boolean; comment: string }

  console.log("Approved:", result.approved);
  console.log("Comment:", result.comment);
}
```

### Melanjutkan dengan Keamanan Tipe

Hook dapat dilanjutkan menggunakan hook yang sama dan sebuah token. Dengan menggunakan hook yang sama, Anda dapat memastikan payload cocok dengan tipe yang telah didefinisikan saat melanjutkan hook.

```typescript lineNumbers
// Use the same defined hook to resume
export async function POST(request: Request) {
  const { token, approved, comment } = await request.json();

  // Type-safe resumption - TypeScript ensures the payload matches
  const result = await approvalHook.resume(token, { // [!code highlight]
    approved, // [!code highlight]
    comment, // [!code highlight]
  }); // [!code highlight]

  if (!result) {
    return Response.json({ error: "Hook not found" }, { status: 404 });
  }

  return Response.json({ success: true, runId: result.runId });
}
```

### Validasi dan Transformasi dengan Skema

Anda dapat menyediakan validasi dan transformasi payload hook saat runtime menggunakan opsi `schema`. Opsi ini menerima validator apa pun yang sesuai dengan spesifikasi [Standard Schema v1](https://standardschema.dev).

<Callout type="info">
Standard Schema adalah spesifikasi standar untuk perpustakaan validasi skema. Sebagian besar perpustakaan validasi populer mendukungnya, termasuk Zod, Valibot, ArkType, dan Effect Schema. Anda juga dapat menulis validator kustom.
</Callout>

#### Menggunakan Zod dengan defineHook

Berikut contoh menggunakan [Zod](https://zod.dev) untuk memvalidasi dan mentransformasikan payload hook:

```typescript lineNumbers
import { defineHook } from "workflow";
import { z } from "zod";

export const approvalHook = defineHook({
  schema: z.object({ // [!code highlight]
    approved: z.boolean(), // [!code highlight]
    comment: z.string().min(1).transform((value) => value.trim()), // [!code highlight]
  }), // [!code highlight]
});

export async function approvalWorkflow(approvalId: string) {
  "use workflow";

  const hook = approvalHook.create({
    token: `approval:${approvalId}`,
  });

  // Payload is automatically typed based on the schema
  const { approved, comment } = await hook;
  console.log("Approved:", approved);
  console.log("Comment (trimmed):", comment);
}
```

Saat melanjutkan hook dari route API, skema memvalidasi dan mentransformasikan payload yang masuk sebelum workflow dilanjutkan:

```typescript lineNumbers
export async function POST(request: Request) {
  // Incoming payload: { token: "...", approved: true, comment: "   Ready!   " }
  const { token, approved, comment } = await request.json();

  // The schema validates and transforms the payload:
  // - Checks that `approved` is a boolean
  // - Checks that `comment` is a non-empty string
  // - Trims whitespace from the comment
  // If validation fails, an error is thrown and the hook is not resumed
  await approvalHook.resume(token, { // [!code highlight]
    approved, // [!code highlight]
    comment, // Automatically trimmed to "Ready!" // [!code highlight]
  }); // [!code highlight]

  return Response.json({ success: true });
}
```

#### Menggunakan Perpustakaan Standard Schema Lainnya

Polanya sama untuk perpustakaan lain yang mematuhi Standard Schema v1. Berikut contoh dengan [Valibot](https://valibot.dev):

```typescript lineNumbers
import { defineHook } from "workflow";
import * as v from "valibot";

export const approvalHook = defineHook({
  schema: v.object({ // [!code highlight]
    approved: v.boolean(), // [!code highlight]
    comment: v.pipe(v.string(), v.minLength(1), v.trim()), // [!code highlight]
  }), // [!code highlight]
});
```

### Menyesuaikan Token

Token digunakan untuk mengidentifikasi hook tertentu dan untuk melanjutkan hook. Anda dapat menyesuaikan token agar lebih spesifik untuk suatu kasus penggunaan.

```typescript lineNumbers
const slackHook = defineHook<{ text: string; userId: string }>();

export async function slackBotWorkflow(channelId: string) {
  "use workflow";

  const hook = slackHook.create({
    token: `slack:${channelId}`, // [!code highlight]
  });

  const message = await hook;
  console.log(`Message from ${message.userId}: ${message.text}`);
}
```

## Fungsi Terkait

* [`createHook()`](/docs/api-reference/workflow/create-hook) - Membuat hook dalam sebuah workflow.
* [`resumeHook()`](/docs/api-reference/workflow-api/resume-hook) - Melanjutkan sebuah hook dengan payload.