---
title: createHook
---

任意のペイロードでワークフローの実行を再開するために使用できる、低レベルなフックプリミティブを作成します。

フックは、webhook の HTTP 固有の制約を受けずに、外部システムが一時停止中のワークフローにデータを送信できるようにします。フックはトークンで識別され、任意のシリアライズ可能なペイロードを受け取ることができます。

```ts lineNumbers
import { createHook } from "workflow"

export async function hookWorkflow() {
  "use workflow";
  const hook = createHook();  // [!code highlight]
  const result = await hook; // Suspends the workflow until the hook is resumed
}
```

## API シグネチャ

### パラメータ

<TSDoc
definition={`
import { createHook } from "workflow";
export default createHook;`
}
showSections={['parameters']}
/>

#### HookOptions

<TSDoc
definition={`
import type { HookOptions } from "workflow";
export default HookOptions;`
}
/>

### 戻り値

<TSDoc
definition={`
import { createHook } from "workflow";
export default createHook;`}
showSections={['returns']}
/>

#### Hook

<TSDoc
definition={`
import type { Hook } from "workflow";
export default Hook;`}
/>

返される `Hook` オブジェクトは `AsyncIterable<T>` も実装しており、`for await...of` 構文を使って受信したペイロードを反復処理できます。

## 使用例

### 基本的な使用法

フックを作成する際に、自動的な型安全性のためにペイロードの型を指定できます。

```typescript lineNumbers
import { createHook } from "workflow"

export async function approvalWorkflow() {
  "use workflow";

  const hook = createHook<{ approved: boolean; comment: string }>(); // [!code highlight]
  console.log("Send approval to token:", hook.token);

  const result = await hook;

  if (result.approved) {
    console.log("Approved with comment:", result.comment);
  }
}
```

### トークンのカスタマイズ

トークンは特定のフックを識別するために使用されます。ユースケースに応じてトークンをより具体的にカスタマイズできます。

```typescript lineNumbers
import { createHook } from "workflow";

export async function slackBotWorkflow(channelId: string) {
  "use workflow";

  // Token constructed from channel ID
  const hook = createHook<SlackMessage>({ // [!code highlight]
    token: `slack_webhook:${channelId}`, // [!code highlight]
  }); // [!code highlight]

  for await (const message of hook) {
    if (message.text === "/stop") {
      break;
    }
    await processMessage(message);
  }
}
```

### 複数のペイロードを待つ

`for await...of` 構文を使用して、複数のペイロードを待つこともできます。

```typescript lineNumbers
import { createHook } from "workflow"

export async function collectHookWorkflow() {
  "use workflow";

  const hook = createHook<{ message: string; done?: boolean }>();

  const payloads = [];
  for await (const payload of hook) { // [!code highlight]
    payloads.push(payload);

    if (payload.done) break;
  }

  return payloads;
}
```

## 関連関数

- [`defineHook()`](/docs/api-reference/workflow/define-hook) - 型安全なフックヘルパー
- [`resumeHook()`](/docs/api-reference/workflow-api/resume-hook) - ペイロードでフックを再開する
- [`createWebhook()`](/docs/api-reference/workflow/create-webhook) - より高レベルのHTTPウェブフック抽象化