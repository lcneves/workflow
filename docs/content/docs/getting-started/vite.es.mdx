---
title: Vite
---

Esta guía explica cómo configurar tu primer workflow en una aplicación Vite. A lo largo del proceso, aprenderás sobre los conceptos fundamentales para usar el kit de desarrollo en tus propios proyectos.

---

<Steps>

<Step>
## Crear tu proyecto Vite

Comienza creando un nuevo proyecto Vite. Este comando creará un nuevo directorio llamado `my-workflow-app` con una configuración mínima y configurará un proyecto Vite en su interior.

```bash
npm create vite@latest my-workflow-app -- --template react-ts
```

Accede al directorio recién creado:

```bash
cd my-workflow-app
```

### Instala `workflow` y `nitro`

```package-install
npm i workflow nitro
```

<Callout>
Aunque Vite proporciona las herramientas de compilación y el servidor de desarrollo, Nitro añade el framework de servidor necesario para las rutas API y el despliegue. Juntos permiten construir aplicaciones full-stack con soporte para workflow. Aprende más sobre Nitro [aquí](https://v3.nitro.build).
</Callout>

### Configura Vite

Añade `workflow()` a tu configuración de Vite. Esto habilita el uso de las directivas "use workflow" y "use step".

```typescript title="vite.config.ts" lineNumbers
import { nitro } from "nitro/vite";
import { defineConfig } from "vite";
import { workflow } from "workflow/vite";

export default defineConfig({
  plugins: [nitro(), workflow()], // [!code highlight]
  nitro: { // [!code highlight]
    serverDir: "./", // [!code highlight]
  }, // [!code highlight]
});
```

<Accordion type="single" collapsible>
  <AccordionItem value="typescript-intellisense" className="[&_h3]:my-0">
    <AccordionTrigger className="text-sm">
      ### Configura IntelliSense para TypeScript (Opcional)
    </AccordionTrigger>
    <AccordionContent className="[&_p]:my-2">

Para habilitar sugerencias útiles en tu IDE, configura el plugin workflow en `tsconfig.json`:

```json title="tsconfig.json" lineNumbers
{
  "compilerOptions": {
    // ... rest of your TypeScript config
    "plugins": [
      {
        "name": "workflow" // [!code highlight]
      }
    ]
  }
}
```

    </AccordionContent>
  </AccordionItem>
</Accordion>

</Step>

<Step>

## Crear tu primer workflow

Crea un nuevo archivo para nuestro primer workflow:

```typescript title="workflows/user-signup.ts" lineNumbers
import { sleep } from "workflow";

export async function handleUserSignup(email: string) {
  "use workflow"; // [!code highlight]

  const user = await createUser(email);
  await sendWelcomeEmail(user);

  await sleep("5s"); // Pause for 5s - doesn't consume any resources
  await sendOnboardingEmail(user);

  return { userId: user.id, status: "onboarded" };
}

```

Rellenaremos esas funciones a continuación, pero echemos un vistazo a este código:

* Definimos una función **workflow** con la directiva "use workflow". Piensa en la función workflow como el _orquestador_ de los **pasos** individuales.
* La función `sleep` del Workflow DevKit nos permite suspender la ejecución del workflow sin consumir recursos. Un sleep puede durar unos segundos, horas, días o incluso meses.

## Crear los pasos de tu workflow

Ahora definamos esas funciones faltantes.

```typescript title="workflows/user-signup.ts" lineNumbers
import { FatalError } from "workflow"

// Our workflow function defined earlier

async function createUser(email: string) {
  "use step"; // [!code highlight]

  console.log(`Creating user with email: ${email}`);

  // Full Node.js access - database calls, APIs, etc.
  return { id: crypto.randomUUID(), email };
}

async function sendWelcomeEmail(user: { id: string; email: string; }) {
  "use step"; // [!code highlight]

  console.log(`Sending welcome email to user: ${user.id}`);

  if (Math.random() < 0.3) {
  // By default, steps will be retried for unhandled errors
   throw new Error("Retryable!");
  }
}

async function sendOnboardingEmail(user: { id: string; email: string}) {
  "use step"; // [!code highlight]

  if (!user.email.includes("@")) {
    // To skip retrying, throw a FatalError instead
    throw new FatalError("Invalid Email");
  }

  console.log(`Sending onboarding email to user: ${user.id}`);
}
```

Al observar este código:

* La lógica de negocio reside dentro de los **pasos**. Cuando un paso es invocado dentro de un **workflow**, se encola para ejecutarse en una solicitud separada mientras el workflow está suspendido, al igual que `sleep`.
* Si un paso lanza un error, como en `sendWelcomeEmail`, el paso se reintentará automáticamente hasta que tenga éxito (o hasta alcanzar el recuento máximo de reintentos del paso).
* Los pasos pueden lanzar un `FatalError` si un error es intencional y no debe reintentarse.

<Callout>
Profundizaremos en workflows, pasos y otras formas de suspender o manejar eventos en [Fundamentos](/docs/foundations).
</Callout>

</Step>

<Step>

## Crear tu manejador de rutas

Para invocar tu nuevo workflow, tendremos que añadirlo a un manejador de ruta API `POST`, `api/signup.post.ts`, con el siguiente código:

```typescript title="api/signup.post.ts"
import { start } from "workflow/api";
import { defineEventHandler } from "nitro/h3";
import { handleUserSignup } from "../workflows/user-signup";

export default defineEventHandler(async ({ req }) => {
  const { email } = await req.json() as { email: string };
  // Executes asynchronously and doesn't block your app
  await start(handleUserSignup, [email]);
  return {
    message: "User signup workflow started",
  }
});
```

Este manejador de rutas crea un endpoint de solicitud `POST` en `/api/signup` que desencadenará tu workflow.

<Callout>
Los workflows pueden activarse desde rutas API o cualquier código del lado del servidor.
</Callout>

</Step>

</Steps>

## Ejecutar en desarrollo

Para iniciar el servidor de desarrollo, ejecuta el siguiente comando en tu terminal desde el directorio raíz de Vite:

```bash
npm run dev
```

Una vez que el servidor de desarrollo esté en funcionamiento, puedes activar tu workflow ejecutando este comando en la terminal:

```bash
curl -X POST --json '{"email":"hello@example.com"}' http://localhost:5173/api/signup
```

Consulta los logs del servidor de desarrollo de Vite para ver la ejecución de tu workflow así como los pasos que se están procesando.

Además, puedes usar la [CLI o la interfaz Web del Workflow DevKit](/docs/observability) para inspeccionar en detalle tus ejecuciones de workflow y los pasos.

```bash
# Open the observability Web UI
npx workflow web
# or if you prefer a terminal interface, use the CLI inspect command
npx workflow inspect runs
```

<img src="/o11y-ui.png" alt="Interfaz Web del Workflow DevKit" />

---

## Desplegar a producción

Las aplicaciones del Workflow DevKit funcionan mejor actualmente cuando se despliegan en [Vercel](https://vercel.com/home) y no requieren configuración especial.

Consulta la sección [Despliegue](/docs/deploying) para aprender cómo se pueden desplegar tus workflows en otros lugares.

## Siguientes pasos

* Aprende más sobre [Fundamentos](/docs/foundations).
* Consulta [Errores](/docs/errors) si encuentras problemas.
* Explora la [Referencia de la API](/docs/api-reference).