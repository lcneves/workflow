---
title: Astro
---

This guide akan memandu Anda melalui pengaturan workflow pertama Anda dalam aplikasi Astro. Sepanjang perjalanan, Anda akan mempelajari lebih lanjut tentang konsep-konsep yang mendasar untuk menggunakan development kit dalam proyek Anda sendiri.

---

<Steps>

<Step>
## Buat Proyek Astro Anda

Mulai dengan membuat proyek Astro baru. Perintah ini akan membuat direktori baru bernama `my-workflow-app` dan menyiapkan proyek Astro minimal di dalamnya.

```bash
npm create astro@latest my-workflow-app -- --template minimal --install --yes
```

Masuk ke direktori yang baru dibuat:

```bash
cd my-workflow-app
```

### Pasang `workflow`

```package-install
npm i workflow
```

### Konfigurasikan Astro

Tambahkan `workflow()` ke konfigurasi Astro Anda. Ini mengaktifkan penggunaan direktif `"use workflow"` dan `"use step"`.

```typescript title="astro.config.mjs" lineNumbers
// @ts-check
import { defineConfig } from "astro/config";
import { workflow } from "workflow/astro";

// https://astro.build/config
export default defineConfig({
  integrations: [workflow()],
});
```

<Accordion type="single" collapsible>
  <AccordionItem value="typescript-intellisense" className="[&_h3]:my-0">
    <AccordionTrigger className="text-sm">
      ### Siapkan IntelliSense untuk TypeScript (Opsional)
    </AccordionTrigger>
    <AccordionContent className="[&_p]:my-2">

Untuk mengaktifkan petunjuk yang membantu di IDE Anda, siapkan plugin workflow di `tsconfig.json`:

```json title="tsconfig.json" lineNumbers
{
  "compilerOptions": {
    // ... rest of your TypeScript config
    "plugins": [
      {
        "name": "workflow" // [!code highlight]
      }
    ]
  }
}
```

    </AccordionContent>
  </AccordionItem>
</Accordion>

</Step>

<Step>

## Buat Workflow Pertama Anda

Buat file baru untuk workflow pertama kita:

```typescript title="src/workflows/user-signup.ts" lineNumbers
import { sleep } from "workflow";

export async function handleUserSignup(email: string) {
  "use workflow"; // [!code highlight]

  const user = await createUser(email);
  await sendWelcomeEmail(user);

  await sleep("5s"); // Pause for 5s - doesn't consume any resources
  await sendOnboardingEmail(user);

  return { userId: user.id, status: "onboarded" };
}

```

Kita akan mengisi fungsi-fungsi itu selanjutnya, tetapi mari lihat kode ini:

* Kita mendefinisikan sebuah fungsi **workflow** dengan direktif `"use workflow"`. Pikirkan fungsi workflow sebagai _orchestrator_ dari **steps** individual.
* Fungsi `sleep` milik Workflow DevKit memungkinkan kita untuk menangguhkan eksekusi workflow tanpa menggunakan sumber daya apa pun. Waktu tidur bisa beberapa detik, jam, hari, atau bahkan bulan.

## Buat Langkah-langkah Workflow Anda

Sekarang mari kita definisikan fungsi-fungsi yang belum ada itu.

```typescript title="src/workflows/user-signup.ts" lineNumbers
import { FatalError } from "workflow"

// Our workflow function defined earlier

async function createUser(email: string) {
  "use step"; // [!code highlight]

  console.log(`Creating user with email: ${email}`);

  // Full Node.js access - database calls, APIs, etc.
  return { id: crypto.randomUUID(), email };
}

async function sendWelcomeEmail(user: { id: string; email: string; }) {
  "use step"; // [!code highlight]

  console.log(`Sending welcome email to user: ${user.id}`);

  if (Math.random() < 0.3) {
  // By default, steps will be retried for unhandled errors
   throw new Error("Retryable!");
  }
}

async function sendOnboardingEmail(user: { id: string; email: string}) {
  "use step"; // [!code highlight]

  if (!user.email.includes("@")) {
    // To skip retrying, throw a FatalError instead
    throw new FatalError("Invalid Email");
  }

  console.log(`Sending onboarding email to user: ${user.id}`);
}
```

Melihat kode ini:

* Logika bisnis berada di dalam **steps**. Ketika sebuah step dipanggil di dalam sebuah **workflow**, step tersebut akan dimasukkan ke antrean untuk dijalankan pada request terpisah sementara workflow ditangguhkan, sama seperti `sleep`.
* Jika sebuah step melemparkan error, seperti di `sendWelcomeEmail`, step tersebut secara otomatis akan dicoba ulang sampai berhasil (atau mencapai batas retry maksimal step tersebut).
* Steps dapat melempar `FatalError` jika sebuah kesalahan disengaja dan seharusnya tidak dicoba ulang.

<Callout>
Kita akan membahas lebih dalam tentang workflows, steps, dan cara lain untuk menangguhkan atau menangani event di [Dasar-dasar](/docs/foundations).
</Callout>

</Step>

<Step>

## Buat Handler Rute Anda

Untuk memanggil workflow baru Anda, kita harus menambahkan workflow tersebut ke handler rute API `POST`, `src/pages/api/signup.ts` dengan kode berikut:

```typescript title="src/pages/api/signup.ts"
import type { APIRoute } from "astro";
import { start } from "workflow/api";
import { handleUserSignup } from "../../workflows/user-signup";

export const POST: APIRoute = async ({ request }: { request: Request }) => {
  const { email } = await request.json();

  // Executes asynchronously and doesn't block your app
  await start(handleUserSignup, [email]);
  return Response.json({
    message: "User signup workflow started",
  });
};

export const prerender = false; // Don't prerender this page since it's an API route
```

Handler rute ini membuat endpoint request `POST` di `/api/signup` yang akan memicu workflow Anda.

<Callout>
Workflows dapat dipicu dari rute API atau kode sisi-server lainnya.
</Callout>

</Step>

</Steps>

## Jalankan di Lingkungan Pengembangan

Untuk memulai server pengembangan Anda, jalankan perintah berikut di terminal pada direktori root Vite:

```bash
npm run dev
```

Setelah server pengembangan berjalan, Anda dapat memicu workflow Anda dengan menjalankan perintah ini di terminal:

```bash
curl -X POST --json '{"email":"hello@example.com"}' http://localhost:5173/api/signup
```

Periksa log server pengembangan Astro untuk melihat eksekusi workflow Anda serta langkah-langkah yang sedang diproses.

Selain itu, Anda dapat menggunakan [Workflow DevKit CLI atau Antarmuka Web](/docs/observability) untuk memeriksa rincian jalannya workflow dan steps.

```bash
npx workflow inspect runs
# or add '--web' for an interactive Web based UI
```

<img src="/o11y-ui.png" alt="Antarmuka Web Workflow DevKit" />

---

## Menerapkan ke Produksi

Aplikasi Workflow DevKit saat ini bekerja paling baik jika dideploy ke [Vercel](https://vercel.com/home) dan tidak memerlukan konfigurasi khusus.

Untuk menerapkan proyek Astro Anda ke Vercel, pastikan [Adaptor Vercel untuk Astro](https://docs.astro.build/en/guides/integrations-guide/vercel) dikonfigurasikan:

```bash
npx astro add vercel
```

Selain itu, periksa bagian [Menerapkan](/docs/deploying) untuk mempelajari bagaimana workflows Anda dapat dideploy di tempat lain.

## Langkah Selanjutnya

* Pelajari lebih lanjut tentang [Dasar-dasar](/docs/foundations).
* Periksa [Kesalahan](/docs/errors) jika Anda menemukan masalah.
* Jelajahi [Referensi API](/docs/api-reference).