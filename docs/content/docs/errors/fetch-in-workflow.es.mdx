---
title: fetch-en-workflow
---

Este error ocurre cuando intentas usar `fetch()` directamente en una función de workflow, o cuando una biblioteca (como el AI SDK) intenta llamar a `fetch()` bajo el capó.

## Mensaje de error

```
Global "fetch" is unavailable in workflow functions. Use the "fetch" step function from "workflow" to make HTTP requests.
```

## Por qué ocurre esto

Las funciones de workflow se ejecutan en un entorno aislado sin acceso directo a `fetch()`.

Muchas bibliotecas realizan solicitudes HTTP bajo el capó. Por ejemplo, la función `generateText()` del AI SDK llama a `fetch()` para hacer solicitudes HTTP a proveedores de IA. Cuando estas bibliotecas se ejecutan dentro de una función de workflow, fallan porque el `fetch` global no está disponible.

## Solución rápida

Importa la función step `fetch` del paquete `workflow` y asígnala a `globalThis.fetch` dentro de tu función de workflow. Esta versión de `fetch` es una función step que envuelve la API estándar `fetch`, gestionando automáticamente la serialización y proporcionando capacidades de reintento. Esto también hará que `fetch()` esté disponible para todas las funciones y bibliotecas en la función de workflow actual.

**Antes:**

```typescript lineNumbers title="workflows/ai.ts"
import { generateText } from "ai";
import { openai } from "@ai-sdk/openai";

export async function chatWorkflow(prompt: string) {
  "use workflow";

  // Error - generateText() calls fetch() under the hood
  const result = await generateText({ // [!code highlight]
    model: openai("gpt-4"), // [!code highlight]
    prompt, // [!code highlight]
  }); // [!code highlight]

  return result.text;
}
```

**Después:**

```typescript lineNumbers title="workflows/ai.ts"
import { generateText } from "ai";
import { openai } from "@ai-sdk/openai";
import { fetch } from "workflow"; // [!code highlight]

export async function chatWorkflow(prompt: string) {
  "use workflow";

  globalThis.fetch = fetch; // [!code highlight]

  // Now generateText() can make HTTP requests via the fetch step
  const result = await generateText({
    model: openai("gpt-4"),
    prompt,
  });

  return result.text;
}
```

## Escenarios comunes

### Integración con el AI SDK

Este es el escenario más habitual: usar funciones del AI SDK que realizan solicitudes HTTP:

```typescript lineNumbers
import { generateText, streamText } from "ai";
import { openai } from "@ai-sdk/openai";
import { fetch } from "workflow"; // [!code highlight]

export async function aiWorkflow(userMessage: string) {
  "use workflow";

  globalThis.fetch = fetch; // [!code highlight]

  // generateText makes HTTP requests to OpenAI
  const response = await generateText({
    model: openai("gpt-4"),
    prompt: userMessage,
  });

  return response.text;
}
```

### Llamadas API directas

También puedes usar la función step `fetch` directamente para tus propias solicitudes HTTP:

```typescript lineNumbers
import { fetch } from "workflow";

export async function dataWorkflow() {
  "use workflow";

  // Use fetch directly for HTTP requests
  const response = await fetch("https://api.example.com/data"); // [!code highlight]
  const data = await response.json();

  return data;
}
```

Para más detalles sobre la función step `fetch`, consulta la [referencia de la API de fetch](/docs/api-reference/workflow/fetch).