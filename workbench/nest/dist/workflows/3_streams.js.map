{"version":3,"sources":["../../src/workflows/3_streams.ts"],"sourcesContent":["export async function genStream(): Promise<ReadableStream<Uint8Array>> {\n  'use step';\n  const stream = new ReadableStream<Uint8Array>({\n    async start(controller) {\n      const encoder = new TextEncoder();\n      for (let i = 0; i < 30; i++) {\n        const chunk = encoder.encode(`${i}\\n`);\n        controller.enqueue(chunk);\n        console.log(`Enqueued number: ${i}`);\n        await new Promise((resolve) => setTimeout(resolve, 2500));\n      }\n      controller.close();\n    },\n  });\n  return stream;\n}\n\nexport async function consumeStreams(\n  ...streams: ReadableStream<Uint8Array>[]\n): Promise<string> {\n  'use step';\n  const parts: Uint8Array[] = [];\n\n  console.log('Consuming streams', streams);\n\n  await Promise.all(\n    streams.map(async (s, i) => {\n      const reader = s.getReader();\n      while (true) {\n        const result = await reader.read();\n        if (result.done) break;\n        console.log(\n          `Received ${result.value.length} bytes from stream ${i}: ${JSON.stringify(new TextDecoder().decode(result.value))}`\n        );\n        parts.push(result.value);\n      }\n    })\n  );\n\n  return Buffer.concat(parts).toString('utf8');\n}\n\nexport async function streams() {\n  'use workflow';\n\n  console.log('Streams workflow started');\n\n  const [s1, s2] = await Promise.all([genStream(), genStream()]);\n  const result = await consumeStreams(s1, s2);\n\n  console.log(`Streams workflow completed. Result: ${result.slice(0, 100)}`);\n\n  return {\n    message: 'Streams processed successfully',\n    dataLength: result.length,\n    preview: result.slice(0, 100),\n  };\n}\n"],"names":["consumeStreams","genStream","streams","stream","ReadableStream","start","controller","encoder","TextEncoder","i","chunk","encode","enqueue","console","log","Promise","resolve","setTimeout","close","parts","all","map","s","reader","getReader","result","read","done","value","length","JSON","stringify","TextDecoder","decode","push","Buffer","concat","toString"],"mappings":";;;;;;;;;;;;IAiBsBA,cAAc;eAAdA;;IAjBAC,SAAS;eAATA;;IA0CAC,OAAO;eAAPA;;;AA1Cf,eAAeD;IAEpB,MAAME,SAAS,IAAIC,eAA2B;QAC5C,MAAMC,OAAMC,UAAU;YACpB,MAAMC,UAAU,IAAIC;YACpB,IAAK,IAAIC,IAAI,GAAGA,IAAI,IAAIA,IAAK;gBAC3B,MAAMC,QAAQH,QAAQI,MAAM,CAAC,GAAGF,EAAE,EAAE,CAAC;gBACrCH,WAAWM,OAAO,CAACF;gBACnBG,QAAQC,GAAG,CAAC,CAAC,iBAAiB,EAAEL,GAAG;gBACnC,MAAM,IAAIM,QAAQ,CAACC,UAAYC,WAAWD,SAAS;YACrD;YACAV,WAAWY,KAAK;QAClB;IACF;IACA,OAAOf;AACT;AAEO,eAAeH,eACpB,GAAGE,OAAqC;IAGxC,MAAMiB,QAAsB,EAAE;IAE9BN,QAAQC,GAAG,CAAC,qBAAqBZ;IAEjC,MAAMa,QAAQK,GAAG,CACflB,QAAQmB,GAAG,CAAC,OAAOC,GAAGb;QACpB,MAAMc,SAASD,EAAEE,SAAS;QAC1B,MAAO,KAAM;YACX,MAAMC,SAAS,MAAMF,OAAOG,IAAI;YAChC,IAAID,OAAOE,IAAI,EAAE;YACjBd,QAAQC,GAAG,CACT,CAAC,SAAS,EAAEW,OAAOG,KAAK,CAACC,MAAM,CAAC,mBAAmB,EAAEpB,EAAE,EAAE,EAAEqB,KAAKC,SAAS,CAAC,IAAIC,cAAcC,MAAM,CAACR,OAAOG,KAAK,IAAI;YAErHT,MAAMe,IAAI,CAACT,OAAOG,KAAK;QACzB;IACF;IAGF,OAAOO,OAAOC,MAAM,CAACjB,OAAOkB,QAAQ,CAAC;AACvC;AAEO,eAAenC;;AAetB"}