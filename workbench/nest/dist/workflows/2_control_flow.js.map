{"version":3,"sources":["../../src/workflows/2_control_flow.ts"],"sourcesContent":["import { FatalError, getStepMetadata, RetryableError } from 'workflow';\n\nasync function delayedMessage(ms: number, message: string): Promise<string> {\n  'use step';\n  console.log(`Sleeping for ${ms}ms and returning ${message}`);\n  await new Promise((resolve) => setTimeout(resolve, ms));\n  return `${message} (sent: ${new Date().toISOString()})`;\n}\n\nasync function add(a: number, b: number): Promise<number> {\n  'use step';\n  console.log(`Adding ${a} and ${b} (sent: ${new Date().toISOString()})`);\n  return a + b;\n}\n\nasync function failingStep(): Promise<string> {\n  'use step';\n  throw new FatalError(`A failed step (sent: ${new Date().toISOString()})`);\n}\n\nasync function retryableStep(): Promise<string> {\n  'use step';\n  const { attempt } = getStepMetadata();\n  console.log('retryableStep attempt:', attempt);\n  if (attempt === 1) {\n    console.log(\n      'Throwing retryable error - this will be retried after 5 seconds'\n    );\n    throw new RetryableError('Retryable error', {\n      // Retry after 5 seconds\n      retryAfter: '5s',\n    });\n  }\n  console.log('Completing successfully');\n  return 'Success';\n}\n\nexport async function control_flow() {\n  'use workflow';\n\n  console.log('Control flow workflow started');\n\n  // Demo Promise.race\n  const raceResult = await Promise.race([\n    delayedMessage(2000, 'I won the race!'),\n    delayedMessage(10000, 'I lost the race'),\n  ]);\n  console.log('Race result:', raceResult);\n\n  // Demo Promise.all\n  const allResults = await Promise.all([\n    delayedMessage(1000, 'First task'),\n    delayedMessage(2000, 'Second task'),\n    add(10, 20),\n  ]);\n  console.log('All results:', allResults);\n\n  // Kick off a step now, and resolve it later\n  const backgroundPromise = delayedMessage(5000, 'Background task completed');\n  const foregroundResults = await Promise.all([\n    delayedMessage(1000, 'First task'),\n    delayedMessage(2000, 'Second task'),\n  ]);\n  console.log('Foreground response:', foregroundResults);\n  const backgroundResult = await backgroundPromise;\n  console.log('Background response:', backgroundResult);\n\n  // Demo error handling - catch regular errors but let FatalErrors bubble up\n  try {\n    await failingStep();\n  } catch (error) {\n    // Only FatalErrors will bubble up here. Non-fatal errors are retried\n    console.log('Caught error:', String(error));\n  }\n\n  // Demo retryable error - this will fail the first time,\n  // and will be retried after one minute.\n  await retryableStep();\n\n  console.log('Control flow workflow completed. See logs for results.');\n\n  return {\n    raceResult,\n    allResults,\n    foregroundResults,\n    backgroundResult,\n  };\n}\n"],"names":["control_flow","delayedMessage","ms","message","console","log","Promise","resolve","setTimeout","Date","toISOString","add","a","b","failingStep","FatalError","retryableStep","attempt","getStepMetadata","RetryableError","retryAfter"],"mappings":";;;;;+BAqCsBA;;;eAAAA;;;AAnCtB,eAAeC,eAAeC,EAAU,EAAEC,OAAe;IAEvDC,QAAQC,GAAG,CAAC,CAAC,aAAa,EAAEH,GAAG,iBAAiB,EAAEC,SAAS;IAC3D,MAAM,IAAIG,QAAQ,CAACC,UAAYC,WAAWD,SAASL;IACnD,OAAO,GAAGC,QAAQ,QAAQ,EAAE,IAAIM,OAAOC,WAAW,GAAG,CAAC,CAAC;AACzD;AAEA,eAAeC,IAAIC,CAAS,EAAEC,CAAS;IAErCT,QAAQC,GAAG,CAAC,CAAC,OAAO,EAAEO,EAAE,KAAK,EAAEC,EAAE,QAAQ,EAAE,IAAIJ,OAAOC,WAAW,GAAG,CAAC,CAAC;IACtE,OAAOE,IAAIC;AACb;AAEA,eAAeC;IAEb,MAAM,IAAIC,WAAW,CAAC,qBAAqB,EAAE,IAAIN,OAAOC,WAAW,GAAG,CAAC,CAAC;AAC1E;AAEA,eAAeM;IAEb,MAAM,EAAEC,OAAO,EAAE,GAAGC;IACpBd,QAAQC,GAAG,CAAC,0BAA0BY;IACtC,IAAIA,YAAY,GAAG;QACjBb,QAAQC,GAAG,CACT;QAEF,MAAM,IAAIc,eAAe,mBAAmB;YAC1C,wBAAwB;YACxBC,YAAY;QACd;IACF;IACAhB,QAAQC,GAAG,CAAC;IACZ,OAAO;AACT;AAEO,eAAeL;;AAkDtB"}