{"version":3,"sources":["../../src/workflows/4_ai.ts"],"sourcesContent":["import { generateText, stepCountIs } from 'ai';\nimport { FatalError } from 'workflow';\nimport z from 'zod/v4';\n\nasync function getWeatherInformation({ city }: { city: string }) {\n  'use step';\n\n  console.log('Getting the weather for city: ', city);\n\n  // A 50% chance of randomly failing. Workflow will retry this.\n  if (Math.random() < 0.5) {\n    throw new Error('Retryable error');\n  }\n\n  // A 10% chance of actually failing. The LLM may retry this?\n  if (Math.random() < 0.1) {\n    throw new FatalError(\n      `Try asking for the weather for Muscat instead, and I'll tell you the weather for ${city}.`\n    );\n  }\n\n  const weatherOptions = ['sunny', 'cloudy', 'rainy', 'snowy', 'windy'];\n\n  return weatherOptions[Math.floor(Math.random() * weatherOptions.length)];\n}\n\nexport async function ai(prompt: string) {\n  'use workflow';\n\n  console.log('AI workflow started');\n\n  // AI SDK's `generateText` just works natively in a workflow thanks to\n  // workflow's automatic fetch hoisting functionality\n  const { text } = await generateText({\n    model: 'openai/o3',\n    prompt,\n  });\n\n  console.log(`AI workflow completed. Result: ${text}`);\n\n  return text;\n}\n\nexport async function agent(prompt: string) {\n  'use workflow';\n\n  console.log('Agent workflow started');\n\n  // You can also provide tools, and if those tools are `steps` - voila, you have yourself\n  // a durable agent with fetches and steps being offloaded\n  const { text } = await generateText({\n    model: 'anthropic/claude-4-opus-20250514',\n    prompt,\n    tools: {\n      getWeatherInformation: {\n        description: 'show the weather in a given city to the user',\n        inputSchema: z.object({ city: z.string() }),\n        execute: getWeatherInformation,\n      },\n    },\n    // This can be a high as you want - no restriction on the lambda workflow runtime\n    stopWhen: stepCountIs(10),\n  });\n\n  console.log(`Agent workflow completed. Result: ${text}`);\n\n  return text;\n}\n"],"names":["agent","ai","getWeatherInformation","city","console","log","Math","random","Error","FatalError","weatherOptions","floor","length","prompt"],"mappings":";;;;;;;;;;;;IA2CsBA,KAAK;eAALA;;IAjBAC,EAAE;eAAFA;;;AAtBtB,eAAeC,sBAAsB,EAAEC,IAAI,EAAoB;IAG7DC,QAAQC,GAAG,CAAC,kCAAkCF;IAE9C,8DAA8D;IAC9D,IAAIG,KAAKC,MAAM,KAAK,KAAK;QACvB,MAAM,IAAIC,MAAM;IAClB;IAEA,4DAA4D;IAC5D,IAAIF,KAAKC,MAAM,KAAK,KAAK;QACvB,MAAM,IAAIE,WACR,CAAC,iFAAiF,EAAEN,KAAK,CAAC,CAAC;IAE/F;IAEA,MAAMO,iBAAiB;QAAC;QAAS;QAAU;QAAS;QAAS;KAAQ;IAErE,OAAOA,cAAc,CAACJ,KAAKK,KAAK,CAACL,KAAKC,MAAM,KAAKG,eAAeE,MAAM,EAAE;AAC1E;AAEO,eAAeX,GAAGY,MAAc;;AAevC;;AAEO,eAAeb,MAAMa,MAAc;;AAwB1C"}